<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recon API - Subdomain Scanner Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1 class="logo">üîç Recon WEB-KD</h1>
            <p class="tagline">Subdomain Reconnaissance Dashboard</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">

            <!-- Action Buttons -->
            <section class="section">
                <div class="action-buttons">
                    <button class="btn btn-primary btn-large" onclick="showNewScanModal()">
                        <span class="btn-icon">‚ûï</span> New Scan
                    </button>
                    <button class="btn btn-secondary btn-large" onclick="showBulkScanModal()">
                        <span class="btn-icon">üìã</span> Bulk Scan
                    </button>
                </div>
            </section>

            <!-- Scan List Section -->
            <section class="section">
                <div class="section-header">
                    <h2>üìã Recent Scans</h2>
                    <button class="btn btn-primary" onclick="loadScans()">
                        <span class="btn-icon">üîÑ</span> Refresh
                    </button>
                </div>
                
                <div id="scans-list" class="scans-grid">
                    <div class="loading">Loading scans...</div>
                </div>
            </section>

            <!-- Scan Details Section -->
            <section class="section" id="scan-details-section" style="display: none;">
                <div class="section-header">
                    <h2>üìä Scan Details</h2>
                    <button class="btn btn-secondary" onclick="closeScanDetails()">
                        <span class="btn-icon">‚úñ</span> Close
                    </button>
                </div>

                <!-- Scan Info -->
                <div class="scan-info-card">
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="info-label">Domain:</span>
                            <span class="info-value" id="detail-domain">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span class="info-value" id="detail-status">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Subdomains:</span>
                            <span class="info-value" id="detail-subdomains-count">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Screenshots:</span>
                            <span class="info-value" id="detail-screenshots-count">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Created:</span>
                            <span class="info-value" id="detail-created">-</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Completed:</span>
                            <span class="info-value" id="detail-completed">-</span>
                        </div>
                    </div>
                </div>

                <!-- Search/Filter -->
                <div class="search-box">
                    <input type="text" id="subdomain-search" placeholder="üîç Search subdomains..." onkeyup="filterSubdomains()">
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">All</button>
                        <button class="filter-btn" data-filter="live" onclick="setFilter('live')">Live</button>
                        <button class="filter-btn" data-filter="dead" onclick="setFilter('dead')">Dead</button>
                    </div>
                </div>

                <!-- Manual Subdomain Addition Form -->
                <div class="manual-subdomain-section">
                    <button class="toggle-btn" onclick="toggleManualSubdomainForm()">
                        <span id="manual-subdomain-toggle-icon">‚ñº</span>
                        <span id="manual-subdomain-toggle-text">Show</span> Manual Subdomain Addition
                    </button>

                    <div id="manual-subdomain-form" class="collapsible-form" style="display: none;">
                        <div class="form-group">
                            <label for="manual-subdomain-input">Subdomain:</label>
                            <input type="text" id="manual-subdomain-input" placeholder="e.g., admin.example.com or https://admin.example.com" />
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="manual-is-live">Is Live:</label>
                                <select id="manual-is-live">
                                    <option value="">Auto-detect</option>
                                    <option value="true">Yes</option>
                                    <option value="false">No</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="manual-http-status">HTTP Status:</label>
                                <input type="number" id="manual-http-status" placeholder="e.g., 200" min="100" max="599" />
                            </div>
                        </div>

                        <div class="form-actions">
                            <button id="add-subdomain-btn" class="btn-primary" onclick="addSubdomainManually()">
                                <span class="btn-icon">‚ûï</span> Add Subdomain
                            </button>
                        </div>

                        <div id="manual-subdomain-error" class="error-message"></div>
                        <div id="manual-subdomain-success" class="success-message"></div>
                    </div>
                </div>

                <!-- Subdomains Table -->
                <div class="table-container">
                    <table class="subdomains-table">
                        <thead>
                            <tr>
                                <th>Subdomain</th>
                                <th>Status</th>
                                <th>HTTP Code</th>
                                <th>Title</th>
                                <th>Webserver</th>
                                <th>CDN</th>
                                <th>Technologies</th>
                                <th>Response Time</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="subdomains-tbody">
                            <tr>
                                <td colspan="9" class="loading">Loading subdomains...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- WAF Detections Table -->
                <div class="table-container">
                    <h3>üõ° WAF Detections</h3>
                    <table class="subdomains-table">
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Protected</th>
                                <th>WAF Name</th>
                                <th>Manufacturer</th>
                            </tr>
                        </thead>
                        <tbody id="waf-tbody">
                            <tr>
                                <td colspan="4" class="loading">Loading WAF detections...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Leak Findings Table -->
                <div class="table-container">
                    <h3>üß© Leak Findings</h3>
                    <table class="subdomains-table">
                        <thead>
                            <tr>
                                <th>Base URL</th>
                                <th>Leaked File URL</th>
                                <th>HTTP Status</th>
                                <th>Type</th>
                                <th>Severity</th>
                                <th>Size</th>
                            </tr>
                        </thead>
                        <tbody id="leaks-tbody">
                            <tr>
                                <td colspan="6" class="loading">Loading leak findings...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Selective Leak Scanning Section -->
                <div class="selective-scan-section" id="selective-scan-section" style="display: none;">
                    <div class="section-header">
                        <h3>üéØ Selective Leak Scanning</h3>
                        <button class="btn btn-secondary btn-small" onclick="toggleSelectiveScanForm()">
                            <span class="btn-icon" id="selective-scan-toggle-icon">‚ñº</span>
                            <span id="selective-scan-toggle-text">Show</span>
                        </button>
                    </div>

                    <div id="selective-scan-form" style="display: none;">
                        <!-- URL Selection -->
                        <div class="selective-scan-form-group">
                            <label class="form-label">
                                <strong>Select URLs to Scan:</strong>
                                <span class="form-hint">(Select from live hosts without WAF protection)</span>
                            </label>

                            <div class="url-selection-controls">
                                <button class="btn btn-small btn-secondary" onclick="selectAllUrls()">
                                    <span class="btn-icon">‚òë</span> Select All
                                </button>
                                <button class="btn btn-small btn-secondary" onclick="deselectAllUrls()">
                                    <span class="btn-icon">‚òê</span> Deselect All
                                </button>
                                <span class="selected-count" id="selected-urls-count">0 URLs selected</span>
                            </div>

                            <div class="url-selection-list" id="url-selection-list">
                                <div class="loading">Loading available URLs...</div>
                            </div>
                        </div>

                        <!-- Scan Mode Selection -->
                        <div class="selective-scan-form-group">
                            <label class="form-label" for="scan-mode-select">
                                <strong>Scan Mode:</strong>
                            </label>
                            <select id="scan-mode-select" class="form-select">
                                <option value="tiny">Tiny (Fast - ~100 paths)</option>
                                <option value="full">Full (Thorough - ~1000 paths)</option>
                            </select>
                        </div>

                        <!-- Submit Button -->
                        <div class="selective-scan-form-group">
                            <button class="btn btn-primary btn-large" onclick="submitSelectiveScan()" id="selective-scan-submit-btn">
                                <span class="btn-icon">üöÄ</span> Start Selective Leak Scan
                            </button>
                        </div>

                        <!-- Error Message -->
                        <div id="selective-scan-error" class="error-message"></div>
                    </div>

                    <!-- Scan Progress -->
                    <div id="selective-scan-progress" style="display: none;">
                        <div class="progress-card">
                            <h4>üîÑ Scan in Progress</h4>
                            <div class="progress-info">
                                <span id="selective-scan-status">Initializing...</span>
                                <span id="selective-scan-percentage">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="selective-scan-progress-bar" style="width: 0%"></div>
                            </div>
                            <div class="progress-details">
                                <div><strong>Task ID:</strong> <span id="selective-scan-task-id">-</span></div>
                                <div><strong>URLs Scanning:</strong> <span id="selective-scan-urls-count">-</span></div>
                                <div><strong>Mode:</strong> <span id="selective-scan-mode">-</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- Scan Results -->
                    <div id="selective-scan-results" style="display: none;">
                        <div class="results-card">
                            <h4>‚úÖ Scan Complete</h4>
                            <div class="results-summary">
                                <div class="result-stat">
                                    <span class="result-label">URLs Scanned:</span>
                                    <span class="result-value" id="result-urls-scanned">-</span>
                                </div>
                                <div class="result-stat">
                                    <span class="result-label">Leaks Found:</span>
                                    <span class="result-value" id="result-leaks-found">-</span>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="reloadScanDetails()">
                                <span class="btn-icon">üîÑ</span> Refresh Results
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Screenshots Gallery -->
                <div class="screenshots-section">
                    <h3>üì∏ Screenshots</h3>
                    <div id="screenshots-gallery" class="screenshots-grid">
                        <div class="loading">Loading screenshots...</div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Recon API - Powered by FastAPI & Celery</p>
        </div>
    </footer>

    <!-- New Scan Modal -->
    <div id="newScanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï New Scan</h2>
                <button class="modal-close" onclick="closeNewScanModal()">‚úñ</button>
            </div>
            <div class="modal-body">
                <label for="newScanDomain">Domain:</label>
                <input type="text" id="newScanDomain" placeholder="example.com" class="modal-input">

                <!-- Amass Configuration Section -->
                <div class="amass-config-section">
                    <h4>‚öôÔ∏è Amass Configuration</h4>

                    <div class="form-group">
                        <label for="amassMode">Mode:</label>
                        <select id="amassMode" class="modal-input">
                            <option value="passive" selected>Passive (Safe, OSINT only)</option>
                            <option value="active">Active (Deep scan with brute-force)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="amassTimeout">Timeout (minutes):</label>
                        <input type="number" id="amassTimeout" class="modal-input"
                               value="30" min="5" max="3600" placeholder="30">
                    </div>

                    <div class="form-group">
                        <label for="amassMaxDnsQueries">Max DNS Queries:</label>
                        <input type="number" id="amassMaxDnsQueries" class="modal-input"
                               value="40" min="1" max="200" placeholder="40">
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="amassUseWordlist">
                            Use Custom Wordlist (httparchive_subdomains)
                        </label>
                    </div>
                </div>

                <div id="newScanError" class="error-message"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeNewScanModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitNewScan()">
                    <span class="btn-icon">üöÄ</span> Start Scan
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Scan Modal -->
    <div id="bulkScanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìã Bulk Scan</h2>
                <button class="modal-close" onclick="closeBulkScanModal()">‚úñ</button>
            </div>
            <div class="modal-body">
                <label for="bulkScanDomains">Domains (one per line):</label>
                <textarea id="bulkScanDomains" placeholder="example1.com&#10;example2.com&#10;example3.com" class="modal-textarea" rows="10"></textarea>
                <div id="bulkScanError" class="error-message"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeBulkScanModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitBulkScan()">
                    <span class="btn-icon">üöÄ</span> Start Bulk Scan
                </button>
            </div>
        </div>
    </div>

    <!-- Subdomain Details Modal -->
    <div id="subdomainDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üîç Subdomain Details</h2>
                <button class="modal-close" onclick="closeSubdomainDetailsModal()">‚úñ</button>
            </div>
            <div class="modal-body">
                <div class="details-grid">
                    <div class="detail-row">
                        <span class="detail-label">Subdomain:</span>
                        <span class="detail-value" id="modal-subdomain">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">URL:</span>
                        <span class="detail-value"><a id="modal-url" href="#" target="_blank" rel="noopener">-</a></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Status:</span>
                        <span class="detail-value" id="modal-status">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">HTTP Status:</span>
                        <span class="detail-value" id="modal-http-status">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Title:</span>
                        <span class="detail-value" id="modal-title">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Webserver:</span>
                        <span class="detail-value" id="modal-webserver">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">CDN:</span>
                        <span class="detail-value" id="modal-cdn">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Content Type:</span>
                        <span class="detail-value" id="modal-content-type">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Content Length:</span>
                        <span class="detail-value" id="modal-content-length">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Response Time:</span>
                        <span class="detail-value" id="modal-response-time">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Primary IP:</span>
                        <span class="detail-value" id="modal-host">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Final URL:</span>
                        <span class="detail-value"><a id="modal-final-url" href="#" target="_blank" rel="noopener">-</a></span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">IPv4 Addresses:</span>
                        <span class="detail-value" id="modal-ipv4">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">IPv6 Addresses:</span>
                        <span class="detail-value" id="modal-ipv6">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Redirect Chain:</span>
                        <span class="detail-value" id="modal-chain">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Technologies:</span>
                        <span class="detail-value" id="modal-technologies">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Discovered By:</span>
                        <span class="detail-value" id="modal-discovered-by">-</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSubdomainDetailsModal()">Close</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js?v=3"></script>
</body>
</html>

